---
title: "API Recipes"
description: "A collection of practical, copy-paste examples showing how to combine Lightdash API endpoints to achieve common workflows."
---

## What are API Recipes?

The Lightdash API is intentionally modular: most endpoints return small, focused pieces of information. While this keeps the API flexible, some real-world tasks require calling multiple endpoints together or assembling responses in a certain order.

**API Recipes** are short guides that show you _how to do exactly that_. Each recipe walks through:

- **What you’re trying to accomplish** (e.g., fetch SQL for all charts in a project)
- **Which endpoints to call and in what order**
- **Example requests** in `curl`
- **Example JSON responses**
- **Optional scripts** in JS/Python when useful

## When should you use Recipes?

Use a recipe when:

- You want to automate a workflow that spans multiple endpoints
- You need to query Lightdash programmatically but aren’t sure which calls to chain
- You want real examples of authentication, pagination, or interpreting metric queries
- You’re building internal tooling or dashboards powered by the Lightdash API

For example, Lightdash doesn’t provide a single endpoint that returns “SQL for every chart,” but you _can_ accomplish this by combining the chart-listing endpoint with the metric-query endpoint—so we provide a ready-made recipe.

## Extract SQL from a Saved Lightdash Chart Using the API

This recipe shows how to fetch the underlying SQL for any saved chart by:

1. Retrieving the chart
2. Extracting its `metricQuery`
3. Compiling that query into SQL

### Step 1: Fetch the saved chart

(You must first create a Personal Access Token (PAT))

```
curl -H "Authorization: ApiKey ldpat_{{your_PAT_token}}" \
  https://analytics.lightdash.cloud/api/v1/saved/{{your_chart_uuid}}
```

### Step 2: Extract the `metricQuery` JSON

```
curl -s \
  -H "Authorization: ApiKey ldpat_{{your_PAT_token}}" \
  https://analytics.lightdash.cloud/api/v1/saved/{{your_chart_uuid}} \
  | jq '.results.metricQuery' > metricQuery.json
```

This writes the chart’s semantic query definition to `metricQuery.json`.

### Step 3: Compile the `metricQuery` into SQL

```
curl -s -X POST \
  -H "Authorization: ApiKey ldpat_{{your_PAT_token}}" \
  -H "Content-Type: application/json" \
  -d @metricQuery.json \
  https://analytics.lightdash.cloud/api/v1/projects/{{your_project_uuid}}/explores/{{your_explore_name}}/compileQuery \
  | jq '.results.query'
```

### Example Output

```
{
  "status": "ok",
  "results": {
    "query": "SELECT
  `accounts`.segment AS `accounts_segment`,
  AVG(`deals`.amount) AS `deals_average_amount`,
  SUM(`deals`.amount) AS `deals_total_amount`
FROM `your_project`.`your_dataset`.`accounts` AS `accounts`
LEFT OUTER JOIN `your_project`.`your_dataset`.`deals` AS `deals`
  ON (`accounts`.account_id) = (`deals`.account_id)
GROUP BY 1
ORDER BY `deals_average_amount` DESC
LIMIT 500"
  }
}
```

### One-Step Solution (pipeline version)

```
curl -s -H "Authorization: ApiKey ldpat_{{your_PAT_token}}" \
  https://analytics.lightdash.cloud/api/v1/saved/{{your_chart_uuid}} \
  | jq '.results.metricQuery' \
  | curl -s -X POST \
      -H "Authorization: ApiKey ldpat_{{your_PAT_token}}" \
      -H "Content-Type: application/json" \
      -d @- \
      https://analytics.lightdash.cloud/api/v1/projects/{{your_project_uuid}}/explores/{{your_explore_name}}/compileQuery \
  | jq '.results.query'
```

## Run a Metric Query and Fetch Results Using the API

This recipe shows how to programmatically execute a Lightdash metric query and retrieve the results table by:

1. Executing a `metricQuery`
2. Getting a `queryUuid` from the response
3. Fetching the paginated results using that UUID
4. _(Optional)_ Compiling the SQL for the query

## Step 1: Execute the metricQuery

(You must first create a Personal Access Token (PAT))

```
curl -X POST \
  -H "Authorization: ApiKey ldpat_{{your_PAT_token}}" \
  -H "Content-Type: application/json" \
  -d '{
    "metrics": ["{{your_metric_name}}"],
    "dimensions": ["{{your_dimension_name}}"],
    "filters": [],
    "sorts": []
  }' \
  https://analytics.lightdash.cloud/api/v1/projects/{{your_project_uuid}}/query/executeMetricQuery
```

### Example response (truncated)

```
{
  "status": "ok",
  "results": {
    "queryUuid": "b3cc9c58-0c73-4f3c-a8f8-1f21d88de1ae",
    "metricQuery": { ... }
  }
}
```

You now have the `queryUuid` that is required for Step 2.

## Step 2: Fetch the query results (paginated)

Use the `queryUuid` from Step 1.

```
curl -X GET \
  -H "Authorization: ApiKey ldpat_{{your_PAT_token}}" \
  "https://analytics.lightdash.cloud/api/v1/projects/{{your_project_uuid}}/query/results?queryUuid={{your_queryUuid}}&page=1&pageSize=500"
```

`page` and `pageSize` let you control pagination of large result sets.

## Step 3: Compile the query to SQL

The `executeMetricQuery` endpoint does **not** currently return the compiled SQL.\
You can compile the `metricQuery` using the `compileQuery` endpoint.

First, save the metricQuery to a file:

```
curl -s \
  -H "Authorization: ApiKey ldpat_{{your_PAT_token}}" \
  https://analytics.lightdash.cloud/api/v1/saved/{{your_chart_uuid}} \
  | jq '.results.metricQuery' > metricQuery.json
```

Then compile it:

```
curl -s -X POST \
  -H "Authorization: ApiKey ldpat_{{your_PAT_token}}" \
  -H "Content-Type: application/json" \
  -d @metricQuery.json \
  https://analytics.lightdash.cloud/api/v1/projects/{{your_project_uuid}}/explores/{{your_explore_name}}/compileQuery \
  | jq '.results.query'
```

### One-Step Solution (execute + fetch first page of results)

This version **runs the query and immediately retrieves the first page** of results.

```
queryUuid=$(curl -s -X POST \
  -H "Authorization: ApiKey ldpat_{{your_PAT_token}}" \
  -H "Content-Type: application/json" \
  -d '{
    "metrics": ["{{your_metric_name}}"],
    "dimensions": ["{{your_dimension_name}}"],
    "filters": [],
    "sorts": []
  }' \
  https://analytics.lightdash.cloud/api/v1/projects/{{your_project_uuid}}/query/executeMetricQuery \
  | jq -r '.results.queryUuid')

curl -s -H "Authorization: ApiKey ldpat_{{your_PAT_token}}" \
  "https://analytics.lightdash.cloud/api/v1/projects/{{your_project_uuid}}/query/results?queryUuid=$queryUuid&page=1&pageSize=500"
```