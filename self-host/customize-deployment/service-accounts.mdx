---
title: "Service accounts"
description: "Configure machine-to-machine authentication for automated API access"
---

Service accounts provide machine-to-machine authentication for automated access to the Lightdash API. Unlike personal access tokens which are tied to individual users, service accounts are organization-level entities designed for applications, CI/CD pipelines, and automated workflows.

<Info>
  Service accounts require an **Enterprise License Key**.
</Info>

## Overview

Service accounts allow you to:

- Authenticate API requests without using personal user credentials
- Grant specific permission scopes (read, edit, or admin)
- Set expiration dates for tokens
- Track token usage and last access time
- Rotate credentials without affecting user accounts

## Enabling service accounts

Add the following environment variable to your configuration:

```bash
SERVICE_ACCOUNT_ENABLED=true
```

After enabling, restart your Lightdash instance for the change to take effect.

Once enabled, organization admins can access service accounts at **Settings** → **Organization** → **Service Accounts**.

## Permission scopes

Service accounts use a hierarchical scope system where higher-level scopes inherit all permissions from lower levels.

| Scope | Description |
| :---- | :---------- |
| `org:read` | Read-only access to organization resources |
| `org:edit` | Modify resources (includes `org:read` permissions) |
| `org:admin` | Full administrative access (includes all permissions) |
| `scim:manage` | Special scope for SCIM-based user provisioning and deprovisioning |

## Creating a service account

### Via UI

1. Navigate to **Settings** → **Organization** → **Service Accounts**
2. Click **Create Service Account**
3. Configure the token:
   - **Description**: Descriptive name for the token (e.g., "Production CI/CD Pipeline")
   - **Expiration**: Optional expiration date (recommended for security)
   - **Scopes**: Select one or more permission scopes
4. Click **Create**
5. **Copy the token immediately** - it will only be shown once
6. Store the token securely in a secrets manager

### Via API

Service accounts can also be created programmatically using an admin user's credentials:

```bash
curl -X POST \
  -H "Authorization: Bearer $ADMIN_SESSION_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "description": "CI/CD Pipeline",
    "expiresAt": "2025-12-31T23:59:59Z",
    "scopes": ["org:admin"]
  }' \
  "$LIGHTDASH_URL/api/v1/organizations/$ORG_UUID/service-accounts"
```

## Using service accounts

### Authentication

Service account tokens use the `Authorization` header with the token value directly:

```bash
curl -H "Authorization: ldsvc_abc123xyz..." \
  "$LIGHTDASH_URL/api/v1/..."
```

### Token format

Service account tokens are prefixed with `ldsvc_`:

```
ldsvc_abc123xyz789...
```

This prefix distinguishes them from:
- Personal access tokens (`ldpat_`)
- SCIM tokens (`scim_`)
- OAuth tokens (`ldapp_`, `ldref_`)

## Common use cases

### CI/CD integration

Automatically compile projects when dbt code changes:

```yaml
# .github/workflows/deploy-lightdash.yml
name: Deploy to Lightdash

on:
  workflow_run:
    workflows: ["dbt Build"]
    types: [completed]
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Trigger Lightdash Refresh
        run: |
          curl -X POST \
            -H "Authorization: ${{ secrets.LIGHTDASH_SERVICE_ACCOUNT }}" \
            "${{ secrets.LIGHTDASH_URL }}/api/v1/projects/${{ secrets.PROJECT_UUID }}/refresh"
```

### Automated data export

Export dashboard data daily:

```python
#!/usr/bin/env python3
import os
import requests
from datetime import datetime

LIGHTDASH_URL = os.environ['LIGHTDASH_URL']
TOKEN = os.environ['SERVICE_ACCOUNT_TOKEN']
DASHBOARD_UUID = os.environ['DASHBOARD_UUID']

headers = {'Authorization': TOKEN}

# Export dashboard as CSV
response = requests.post(
    f"{LIGHTDASH_URL}/api/v1/dashboards/{DASHBOARD_UUID}/export/csv",
    headers=headers
)

# Save to file with timestamp
filename = f"dashboard_export_{datetime.now().strftime('%Y%m%d')}.csv"
with open(filename, 'wb') as f:
    f.write(response.content)

print(f"Exported to {filename}")
```

## Security best practices

- **Set expiration dates**: Always configure token expiration for production tokens
- **Use minimal scopes**: Grant only the permissions required for the specific use case
- **Store securely**: Keep tokens in a secrets manager, never in source code
- **Rotate regularly**: Create new tokens and delete old ones periodically
- **Monitor usage**: Check "Last Used At" timestamps to identify unused tokens

## Monitoring

Track service account usage:

1. **Last Used At**: Check when each token was last accessed in the Service Accounts UI
2. **Audit Logs**: Review API calls made by service accounts
3. **Alerts**: Set up alerts for tokens not used in 90 days or unusual API usage patterns

## API reference

### Create service account

**POST** `/api/v1/organizations/{organizationUuid}/service-accounts`

**Request:**
```json
{
  "description": "CI/CD Pipeline",
  "expiresAt": "2025-12-31T23:59:59Z",
  "scopes": ["org:admin"]
}
```

**Response:**
```json
{
  "token": "ldsvc_abc123...",
  "expiresAt": "2025-12-31T23:59:59Z"
}
```

### List service accounts

**GET** `/api/v1/organizations/{organizationUuid}/service-accounts`

**Response:**
```json
{
  "results": [
    {
      "uuid": "sa-uuid-123",
      "description": "CI/CD Pipeline",
      "createdAt": "2024-01-01T00:00:00Z",
      "expiresAt": "2025-12-31T23:59:59Z",
      "lastUsedAt": "2024-12-10T14:30:00Z",
      "scopes": ["org:admin"],
      "createdByUserUuid": "user-uuid-456"
    }
  ]
}
```

### Delete service account

**DELETE** `/api/v1/organizations/{organizationUuid}/service-accounts/{tokenUuid}`

**Response:** `204 No Content`

## Troubleshooting

### Authentication failed (401 Unauthorized)

Possible causes:
- Token is expired
- Token was deleted
- Token format is incorrect
- Missing `Authorization` header

Verify token format (should start with `ldsvc_`) and check token status in the Service Accounts UI.

### Permission denied (403 Forbidden)

Possible causes:
- Insufficient scope for the operation
- Trying to access private resources

Check required scope in API documentation and verify token has appropriate scope:
- Read operations → `org:read`
- Modify operations → `org:edit`
- Admin operations → `org:admin`

### Service accounts section missing in settings

Possible causes:
- `SERVICE_ACCOUNT_ENABLED` not set to `true`
- User is not an organization admin
- Missing Enterprise license

Verify the environment variable is set and restart Lightdash:

```bash
# Verify in health endpoint
curl "$LIGHTDASH_URL/api/v1/health" | jq '.isServiceAccountEnabled'
```

## Migrating from personal access tokens

If you're currently using personal access tokens (PATs) for automation:

1. **Audit current usage**: Identify where PATs are used in scripts and CI/CD
2. **Create equivalent service accounts**: Map PAT permissions to service account scopes
3. **Update credentials**: Replace `ldpat_` tokens with `ldsvc_` tokens
4. **Test thoroughly**: Verify all API calls succeed before removing old PATs
5. **Delete old PATs**: Remove personal access tokens after confirming service accounts work

Benefits of migrating:
- Tokens persist when users leave the organization
- Clear attribution of automated actions in audit logs
- Scoped permissions instead of inheriting user permissions
- Centralized token management in organization settings

## FAQ

**Can I use service accounts with the Lightdash CLI?**

Not directly. The CLI uses different authentication mechanisms. Service accounts are designed for API access only.

**How many service accounts can I create?**

There is no hard limit. We recommend creating one per application/purpose for better auditing and easier rotation.

**Do service accounts count toward user licenses?**

No, service accounts are not counted as users and do not consume user licenses.

**Can service accounts access private spaces?**

Service accounts with `org:read` cannot access private spaces. Higher-level scopes (`org:edit`, `org:admin`) can access resources based on their permissions.

**What happens when a service account token expires?**

API requests using expired tokens will receive a `401 Unauthorized` error. Create a new service account before the old one expires to ensure continuity.

**Can I modify a service account's scopes after creation?**

No, scopes cannot be modified. You must create a new service account with the desired scopes and delete the old one.
